<!DOCTYPE html>
<html>
<head>
    <title>Painel de Chamada</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #2c3e50; color: white; text-align: center; }
        .box { padding: 40px; margin: 20px; border-radius: 15px; width: 80%; max-width: 600px; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        #senha-box { background-color: #e74c3c; animation: flash-bg 0.5s 2; } /* Animação simples de flash */
        #vaga-box { background-color: #3498db; }
        h1 { font-size: 8em; margin: 0; }
        h3 { font-size: 2em; margin-top: 0; text-transform: uppercase; }

        /* Animação para dar destaque à nova senha */
        @keyframes flash-bg {
            0% { background-color: #f1c40f; }
            100% { background-color: #e74c3c; }
        }
    </style>
</head>
<body>
    <div class="box" id="senha-box">
        <h3>SENHA CHAMADA</h3>
        <h1 id="senha-display">---</h1>
    </div>
    <div class="box" id="vaga-box">
        <h3>DIRIJA-SE AO GUICHÊ</h3>
        <h1 id="vaga-display">---</h1>
    </div>

    <script>
        // Variável para evitar atualização desnecessária e controlar a animação
        let ultimaChamada = ''; 

        function buscarStatus() {
            fetch('/status')
            .then(response => response.json())
            .then(data => {
                const senhaAtual = data.senha;
                const vagaAtual = data.vaga;

                // Verifica se houve mudança para aplicar o efeito flash
                if (senhaAtual !== ultimaChamada) {
                    document.getElementById('senha-display').textContent = senhaAtual;
                    document.getElementById('vaga-display').textContent = vagaAtual;
                    
                    // Aplica e remove a classe de animação para o flash
                    const senhaBox = document.getElementById('senha-box');
                    senhaBox.classList.remove('animate');
                    void senhaBox.offsetWidth; // Força o reflow para reiniciar a animação
                    senhaBox.classList.add('animate');
                    
                    // Atualiza a última chamada
                    ultimaChamada = senhaAtual; 
                }
            })
            .catch(error => {
                console.error('Erro ao buscar status:', error);
                document.getElementById('senha-display').textContent = 'ERRO';
            });
        }

        // Busca o status a cada 3 segundos (Polling)
        setInterval(buscarStatus, 3000); 

        // Inicia a primeira busca imediatamente
        buscarStatus();
    </script>
</body>
</html>
